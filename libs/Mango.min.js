if(mgNativeDic={},mgNativeFuncDic={},!Native){function Native(apiName,data){mgNativeDic[apiName]&&mgNativeDic[apiName](data)}function NativeFunc(apiName,data,callback){mgNativeFuncDic[apiName]&&mgNativeFuncDic[apiName](data,callback)}var mg=function(){};mg.SetActionApi=function(apiName,callback){mgNativeDic[apiName]=callback},mg.SetFuncApi=function(apiName,callback){mgNativeFuncDic[apiName]=callback}}__SafeDo=function(action){return new Promise((function(resolve,reject){try{action(resolve)}catch(ex){console.error(ex),mgLog.Error("JS错误",ex),reject(ex)}}))};var mgLog=function(){};mgLog.Debug=function(msg,e){__SafeDo((function(){Native("mgLog.Debug",{message:msg,exception:e})}))},mgLog.Info=function(msg,e){__SafeDo((function(){Native("mgLog.Info",{message:msg,exception:e})}))},mgLog.Warn=function(msg,e){__SafeDo((function(){Native("mgLog.Warn",{message:msg,exception:e})}))},mgLog.Error=function(msg,e){__SafeDo((function(){Native("mgLog.Error",{message:msg,exception:e})}))},mgLog.Fatal=function(msg,e){__SafeDo((function(){Native("mgLog.Fatal",{message:msg,exception:e})}))},"undefined"==typeof mgThis&&(mgThis=function(){}),mgThis.GetResPath=function(name){return mgThis.AppInfo.RootDirectory+"/"+name},mgThis.GetUserToken=function(){return __SafeDo((function(callback){NativeFunc("mgThis.GetUserToken",{key:mgPage.Key},callback)}))},mgThis.GetAppInfo=function(){return __SafeDo((function(callback){NativeFunc("mgThis.GetAppInfo",{key:mgPage.Key},callback)}))};var mgConfig=function(){};mgConfig.GetPlatform=function(){return __SafeDo((function(callback){NativeFunc("mgConfig.Platform",null,callback)}))},mgConfig.GetApplicationName=function(){return __SafeDo((function(callback){NativeFunc("mgConfig.ApplicationName",null,callback)}))},mgConfig.GetApplicationVersion=function(){return __SafeDo((function(callback){NativeFunc("mgConfig.ApplicationVersion",null,callback)}))},mgConfig.GetServerAddress=function(){return __SafeDo((function(callback){NativeFunc("mgConfig.ServerAddress",null,callback)}))};var mgContext=function(){};mgContext.GetUserId=function(){return __SafeDo((function(callback){NativeFunc("mgContext.UserId",null,callback)}))},mgContext.GetProjectId=function(){return __SafeDo((function(callback){NativeFunc("mgContext.ProjectId",null,callback)}))},mgContext.GetConnectionState=function(){return __SafeDo((function(callback){NativeFunc("mgContext.ConnectionState",null,callback)}))},mgContext.GetCurrentProject=function(map){return __SafeDo((function(callback){NativeFunc("mgContext.GetCurrentProject",map,callback)}))},mgContext.GetCurrentUser=function(map){return __SafeDo((function(callback){NativeFunc("mgContext.GetCurrentUser",map,callback)}))},mgContext.GetPrivilegeBatch=function(moduleKeys){return __SafeDo((function(callback){NativeFunc("mgContext.GetPrivilege",moduleKeys,callback)}))},mgContext.GetPrivilege=function(moduleKey){return __SafeDo((function(callback){NativeFunc("mgContext.GetPrivilege",[moduleKey],callback)})).then((function(results){return results[0]}))};var mgCache=function(){};mgCache.Get=function(key,defaultValue,setDefault){return __SafeDo((function(callback){NativeFunc("mgCache.Get",{key:key,default:defaultValue||JSON.stringify(defaultValue),setDefault:setDefault},(function(s){callback(JSON.stringify(s))}))}))},mgCache.Set=function(key,value,expiredSeconds){return __SafeDo((function(callback){NativeFunc("mgCache.Set",{key:key,value:JSON.stringify(value),expiredSeconds:expiredSeconds},callback)}))},mgCache.Remove=function(key){return __SafeDo((function(callback){NativeFunc("mgCache.Remove",key,callback)}))},mgCache.Exists=function(key){return __SafeDo((function(callback){NativeFunc("mgCache.Exists",key,callback)}))};var mgService=function(){};mgService.Invoke=function(serviceName,param){return __SafeDo((function(callback){NativeFunc("mgService.Invoke",{appKey:mgThis.AppInfo.Key,serviceName:serviceName,param:JSON.stringify(param)},callback)}))},mgService.InvokeAsync=function(serviceName,param){return __SafeDo((function(callback){NativeFunc("mgService.InvokeAsync",{appKey:mgThis.AppInfo.Key,serviceName:serviceName,param:JSON.stringify(param)},callback)}))},mgService.Register=function(serviceName,param){__SafeDo((function(){Native("mgService.Register",{appKey:mgThis.AppInfo.Key,serviceName:serviceName,param:param})}))};var mgSlot=function(){};mgSlot.PushPlug=function(plug,callback){__SafeDo((function(){NativeFunc("mgSlot.PushPlug",{appKey:mgThis.AppInfo.Key,plug:plug},callback)}))},mgSlot.PullPlug=function(slotName,name){__SafeDo((function(){Native("mgSlot.PullPlug",{appKey:mgThis.AppInfo.Key,slotName:slotName,name:name})}))},mgSlot.GetPlugs=function(slotName){return __SafeDo((function(callback){NativeFunc("mgSlot.GetPlugs",{slotName:slotName},callback)}))},mgSlot.Register=function(slotName,description){__SafeDo((function(){Native("mgSlot.Register",{appKey:mgThis.AppInfo.Key,slot:{Name:slotName,Description:description}})}))};var mgDialog=function(){};mgDialog.Alert=function(header,content){__SafeDo((function(){Native("mgDialog.Alert",{header:header,content:content})}))},mgDialog.ShowMessage=function(header,content){return __SafeDo((function(callback){NativeFunc("mgDialog.ShowMessage",{header:header,content:content},callback)}))},mgDialog.ShowDialog=function(settings){return __SafeDo((function(callback){NativeFunc("mgDialog.ShowDialog",settings,callback)}))},mgDialog.ShowWindow=function(settings){__SafeDo((function(){Native("mgDialog.ShowWindow",settings)}))};var mgStatus=function(){};mgStatus.SetStatusInfo=function(message,progress,showSeconds){__SafeDo((function(){Native("mgStatus.SetStatusInfo",{message:message,progress:progress,showSeconds:showSeconds})}))},mgStatus.SetDefaultStatus=function(){__SafeDo((function(){Native("mgStatus.SetDefaultStatus",null)}))};var mgTip=function(){};mgTip.Show=function(message,progress){__SafeDo((function(){Native("mgTip.Show",{message:message,progress:progress})}))},mgTip.Close=function(){__SafeDo((function(){Native("mgTip.Close",null)}))};var mgWeb=function(){};mgWeb.AddWebMsgHandler=function(handlerKey,message){return __SafeDo((function(callback){NativeFunc("mgWeb.AddWebMsgHandler",{_key:handlerKey,appKey:mgThis.AppInfo.Key,message:message},callback)}))},mgWeb.RemoveWebMsgHandler=function(handlerKey,message){__SafeDo((function(){Native("mgWeb.RemoveWebMsgHandler",{_key:handlerKey,appKey:mgThis.AppInfo.Key,message:message})}))},mgWeb.SendWebMsg=function(message,content,boardcastType){return __SafeDo((function(callback){NativeFunc("mgWeb.SendWebMsg",{message:message,content:content,boardcastType:boardcastType},callback)}))},mgWeb.GetUrl=function(apiPath,urlParam){return __SafeDo((function(callback){NativeFunc("mgWeb.GetUrl",{apiPath:apiPath,urlParam:urlParam},callback)}))},mgWeb.GetResult=function(settings){return __SafeDo((function(callback){settings.appKey=mgThis.AppInfo.Key,NativeFunc("mgWeb.GetResult",settings,callback)}))},mgWeb.Post=function(settings){return __SafeDo((function(callback){settings.appKey=mgThis.AppInfo.Key,NativeFunc("mgWeb.Post",settings,callback)}))};var mgNavi=function(){};if(mgNavi.Go=function(address,title,data){__SafeDo((function(){Native("mgNavi.Go",{appKey:mgThis.AppInfo.Key,address:address,title:title,data:data})}))},mgNavi.GoBack=function(data){__SafeDo((function(){Native("mgNavi.GoBack",data)}))},mgNavi.GetData=function(){return __SafeDo((function(callback){NativeFunc("mgNavi.GetData",null,callback)}))},void 0===mgPage){var mgPage=function(){};mgPage.Key=""}mgPage.OnLoaded=function(data){},mgPage.OnAppearing=function(data){},mgPage.OnDisappearing=function(data){},mgPage.SetTitle=function(title){__SafeDo((function(){Native("mgPage.SetTitle",{key:mgPage.Key,title:title})}))},mgPage.AddMenuItem=function(text,icon,callback){return __SafeDo((function(){NativeFunc("mgPage.AddMenuItem",{key:mgPage.Key,text:text,icon:mgThis.GetResPath(icon)},callback)}))},mgPage.RemoveMenuItem=function(text){__SafeDo((function(){Native("mgPage.RemoveMenuItem",{key:mgPage.Key,text:text})}))},mgPage.Capture=function(){return __SafeDo((function(callback){NativeFunc("mgPage.Capture",{key:mgPage.Key},callback)}))};var mgPlatform=function(){};mgPlatform.PickPhoto=function(type){return __SafeDo((function(callback){NativeFunc("mgPlatform.PickPhoto",{type:type},callback)}))},mgPlatform.OpenFile=function(url){__SafeDo((function(){Native("mgPlatform.OpenFile",{url:url})}))},mgPlatform.Share=function(filePath,subject,message){__SafeDo((function(){Native("mgPlatform.Share",{subject:subject,message:message,filePath:filePath})}))},mgPlatform.ReadFile=function(filePath){return __SafeDo((function(callback){NativeFunc("mgPlatform.ReadFile",filePath,callback)}))},mgPlatform.SaveFile=function(filePath,data){return __SafeDo((function(callback){NativeFunc("mgPlatform.SaveFile",{filePath:filePath,data:data},callback)}))},mgPlatform.TelNumber=function(number){__SafeDo((function(){Native("mgPlatform.TelNumber",{number:number})}))},mgPlatform.ClearCache=function(){__SafeDo((function(){Native("mgPlatform.ClearCache",{})}))},mgPlatform.EnableDev=function(enable){__SafeDo((function(){Native("mgPlatform.EnableDev",{enable:enable})}))},mgPlatform.DevConnection=function(address){__SafeDo((function(){Native("mgPlatform.DevConnection",{address:address})}))},mgPlatform.Logout=function(){__SafeDo((function(){Native("mgPlatform.Logout",{})}))},mgPlatform.SelectedProject=function(){return __SafeDo((function(callback){NativeFunc("mgPlatform.SelectedProject",{},callback)}))},mgPlatform.GetLocation=function(){return __SafeDo((function(callback){NativeFunc("mgPlatform.GetLocation",{},callback)}))},mgPlatform.OpenMapView=function(longitude,latitude,address){return __SafeDo((function(callback){NativeFunc("mgPlatform.OpenMapView",{longitude:longitude,latitude:latitude,address:address},callback)}))},mgPlatform.GetSettingInfo=function(){return __SafeDo((function(callback){NativeFunc("mgPlatform.GetSettingInfo",{},callback)}))};var mgWorkflow=function(){};mgWorkflow.Create=function(firstStepFormType,dataId,state,firstStepFormParam){__SafeDo((function(){Native("mgWorkflow.Create",{firstStepFormType:firstStepFormType,dataId:dataId,firstStepFormParam:firstStepFormParam,state:state})}))},mgWorkflow.ShowTaskDetail=function(dataId){__SafeDo((function(){Native("mgWorkflow.ShowTaskDetail",{dataId:dataId})}))},mgWorkflow.IsExist=function(dataId){return __SafeDo((function(callback){NativeFunc("mgWorkflow.IsExist",{dataId:dataId},callback)}))},mgWorkflow.GetDataStatus=function(dataIds){return __SafeDo((function(callback){NativeFunc("mgWorkflow.GetDataStatus",dataIds,callback)}))},mgWorkflow.GetDataCurrentTasks=function(dataIds){return __SafeDo((function(callback){NativeFunc("mgWorkflow.GetDataCurrentTasks",dataIds,callback)}))};var mgTaskForm=function(){};mgTaskForm.Register=function(formType,url){__SafeDo((function(){Native("mgTaskForm.Register",{appKey:mgThis.AppInfo.Key,formType:formType,url:url})}))};var mgForm=function(){};mgForm.Set=function(key,value){__SafeDo((function(){Native("mgForm.Set",{key:mgPage.Key,[key]:value})}))},mgForm.Resize=function(){console.debug("mgForm.Reize - body height:"+document.body.clientHeight),mgForm.Set("height",document.body.clientHeight)};var mgApi=function(){};function mgDateToTicks(date){return 1e4*date.getTime()+621355968e9}mgApi.UploadFile=function(filePath,fileId,showProgress,alertError){return __SafeDo((function(callback){NativeFunc("mgApi.UploadFile",{appKey:mgThis.AppInfo.Key,filePath:filePath,fileId:fileId,showProgress:showProgress,alertError:alertError},callback)}))},mgApi.DownloadFile=function(fileId,version,showProgress){return __SafeDo((function(callback){NativeFunc("mgApi.DownloadFile",{appKey:mgThis.AppInfo.Key,fileId:fileId,version:version,showProgress:showProgress},callback)}))};